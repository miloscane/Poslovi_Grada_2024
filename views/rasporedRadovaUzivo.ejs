<%- include ("partials/header") -%>
	<script>
		var podizvodjaci  = ["mile--1672650353244","SeHQZ--1672650353244","IIwY4--1672650358507","e3MHS--1675759749849","eupy8--1676039178890","S5mdP--1677669290493","0ztkS--1672041761145","ylSnq--1672041756318"];

		var crni = ["Momir Lutovac","Nenad Pape≈°","Branko Milosevic"];
		var crveni = ["Goran Stoiljkoviƒá","Dalibor Tripkoviƒá","Zoran Veselinoviƒá","Uros Janjic","Sasa Jovanoski","Zoran Mihajloviƒá"];
		var narandzasti = ["Tomislav Maksimovic","Igor Bakiƒá","Kumar Mahendra","Aleksandar  Ramanoviƒá"];
		var zuti = ["Goran Stojanoviƒá","Aleksandar Pavloviƒá","Du≈°ko Spasoviƒá","Anƒëelo Vasiƒá"];
		var svetloPlavi = ["Vojin Civriƒá","≈Ωivoslav Stanƒçiƒá","Zoran Ostojiƒá"];
		var tamnoPlavi = ["Boro Bjelovic","Nenad Spasiƒá","Nenad Obradoviƒá","Aleksandar Radosvaljeviƒá"];

		var majstori = <%-JSON.stringify(majstori)%>;
		majstori.sort((a, b) => a.ime.localeCompare(b.ime));
		for(var i=0;i<majstori.length;i++){
			majstori[i].raspored = 100;
			if(crni.indexOf(majstori[i].ime)>=0){
				majstori[i].raspored = 10;
			}else if(crveni.indexOf(majstori[i].ime)>=0){
				majstori[i].raspored = 20;
			}else if(narandzasti.indexOf(majstori[i].ime)>=0){
				majstori[i].raspored = 30;
			}else if(zuti.indexOf(majstori[i].ime)>=0){
				majstori[i].raspored = 40;
			}else if(svetloPlavi.indexOf(majstori[i].ime)>=0){
				majstori[i].raspored = 50;
			}
			console.log(majstori[i].ime + "--"+majstori[i].raspored)
		}

		majstori.sort((a, b) => a.raspored - b.raspored);

		var danasnjeDodele = <%-JSON.stringify(danasnjeDodele)%>;

		var dodele = <%-JSON.stringify(dodele)%>;
		for(var i=0;i<majstori.length;i++){
			majstori[i].dodele = [];
			for(var j=0;j<dodele.length;j++){
				if(majstori[i].uniqueId==dodele[j].majstor){
					majstori[i].dodele.push(dodele[j])
				}
			}
		}

		

		var START_H = 7
		var START_M = 0;   // 07:00
		var END_H   = 21;
		var END_M   = 0;  // 20:00
		var STEP_MIN = 30; 
		var hour = START_H;
		var minute = START_M;
		var times = [];
		while (hour < END_H || (hour === END_H && minute === END_M)) {
		    const h = String(hour).padStart(2,'0');
		    const m = String(minute).padStart(2,'0');
		    times.push(`${h}:${m}`);
		    minute += STEP_MIN;
		    if (minute >= 60) { minute = 0; hour++; }
		}

		function getTopForTime(timeStr) {
			// ---- Config (same as your generation logic) ----
			const START_H = 7;
			const START_M = 0;
			const STEP_MIN = 30; // half-hour per row
			const timeline = document.querySelector('.rasporedRadovaUzivo');
			const sample = document.querySelector('.timestamp');
			if (!timeline || !sample) return 0;

			// ---- Convert "HH:MM" into total minutes ----
			const [h, m] = timeStr.split(':').map(Number);
			const targetMin = h * 60 + m;
			const startMin = START_H * 60 + START_M;
			const diffMin = targetMin - startMin;
			if (diffMin < 0) return 0; // before start

			// ---- Compute position ----
			const slotH = sample.offsetHeight; // height of each timestamp row
			const padTop = parseFloat(getComputedStyle(timeline).paddingTop) || 0;
			const slots = diffMin / STEP_MIN;
			const topPx = padTop + slots * slotH;

			return topPx;
		}

		function getHeightForDuration(durationStr) {
			const STEP_MIN = 30; // one .timestamp = 30 minutes
			const sample = document.querySelector('.timestamp');
			if (!sample) return 0;

			const slotH = sample.offsetHeight;

			// Parse duration "HH:MM"
			const [h, m] = durationStr.split(':').map(Number);
			const totalMin = h * 60 + m;

			// Convert minutes to pixels
			const height = (totalMin / STEP_MIN) * slotH;

			return height;
		}

		function adjustLeftPositionsTight(elem) {
		  const container = elem;
		  if (!container) return;

		  const wraps = Array.from(container.querySelectorAll(".dodelaWrap"));
		  if (!wraps.length) return;

		  // Make sure container is positioning context
		  if (getComputedStyle(container).position === "static") {
		    container.style.position = "relative";
		  }

		  // Sort by vertical position so earlier items become anchors
		  wraps.sort((a, b) => {
		    const ta = parseFloat(a.style.top) || 0;
		    const tb = parseFloat(b.style.top) || 0;
		    return ta - tb || a.offsetHeight - b.offsetHeight;
		  });

		  // Reset any previous left
		  wraps.forEach(el => { el.style.left = "0px"; });

		  const GAP = 4; // px space between neighbors

		  for (let i = 0; i < wraps.length; i++) {
		    const a = wraps[i];
		    const aTop = parseFloat(a.style.top) || 0;
		    const aBottom = aTop + a.offsetHeight;

		    // Find the rightmost edge among *previous* overlapping elements
		    let left = 0;
		    for (let j = 0; j < i; j++) {
		      const b = wraps[j];
		      const bTop = parseFloat(b.style.top) || 0;
		      const bBottom = bTop + b.offsetHeight;

		      const overlapsVertically = aTop < bBottom && aBottom > bTop;
		      if (overlapsVertically) {
		        const bLeft = parseFloat(b.style.left) || 0;
		        const bRight = bLeft + b.offsetWidth;
		        if (bRight > left) left = bRight; // park right after the farthest-right overlap
		      }
		    }

		    // Small gap so edges don‚Äôt touch
		    if (left > 0) left += GAP;

		    // Optional: keep inside container
		    const maxLeft = Math.max(0, container.clientWidth - a.offsetWidth);
		    if (left > maxLeft) left = maxLeft;

		    a.style.left = left + "px";
		    a.style.position = "absolute"; // make sure it‚Äôs absolutely positioned
		  }
		}

		 function getNowTopPx() {
    const sample = document.querySelector('.timestamp');
    if (!sample) return 0;
    const slotH = sample.offsetHeight;               // px per 30min
    const now = new Date();
    let h = now.getHours(), m = now.getMinutes();

    // clamp to schedule window
    const startMin = START_H*60 + START_M;
    const endMin   = END_H*60   + END_M;
    const nowMin   = Math.min(Math.max(h*60 + m, startMin), endMin);

    // allow smooth, fractional position (not just on 30-min grid)
    const slots = (nowMin - startMin) / STEP_MIN;   // e.g., 09:15 -> 4.5 slots from 07:00
    return slots * slotH;
  }

		function scrollWrappersToNow({align = 'center', extraOffset = 0, contentOffsetY = 0} = {}) {
  const topPx = getNowTopPx();
  const wrappers = document.querySelectorAll('.rasporedRadovaUzivo .wrapper');

  wrappers.forEach(wrap => {
    const header = wrap.querySelector('.ime');
    const headerH = header ? header.offsetHeight : 0;

    let target = topPx;
    if (align === 'center') {
      target = topPx - (wrap.clientHeight - headerH) / 2;
    } else if (align === 'start') {
      target = Math.max(0, topPx - headerH);
    } else if (align === 'end') {
      target = topPx - (wrap.clientHeight - headerH);
    }
    target = Math.max(0, target + extraOffset);

    // 1) scroll
    wrap.scrollTo({ top: target, behavior: 'smooth' });
    
  });
}

function ensureBrojNalogaVisible({
  basePad = 0,
  extraY  = 0,
  maxPad  = 200
} = {}) {
  document.querySelectorAll('.dodelaWrap').forEach(box => {
    const broj  = box.querySelector('.brojNaloga');
    if (!broj) return;

    const wrap  = box.closest('.wrapper');
    if (!wrap) return;

    const header = wrap.querySelector('.ime');
    const headerH = header ? header.offsetHeight : 0;

    // viewport of the wrapper (account for header)
    const wrapRect = wrap.getBoundingClientRect();
    const viewportTop = wrapRect.top + headerH;

    // box rect relative to viewport
    const boxRect = box.getBoundingClientRect();

    // how much of the box's top is hidden above the visible area of the wrapper
    const hiddenTop = Math.max(0, viewportTop - boxRect.top);

    // pad = base + your adjustable offset + exactly how much is hidden
    const pad = Math.min(maxPad, basePad + extraY + hiddenTop);
    broj.style.paddingTop = pad + 'px';
  });
}


function layoutNoOverlap(container) {
  // Uveri se da ‚Äúcontainer‚Äù ima prave elemente
  const cards = Array.from(container.querySelectorAll('.dodelaWrap'));
  console.log('found cards in this container:', cards.length);

  // Ako oƒçekuje≈° vi≈°e a dobija≈° 1, proveri: da li si stvarno dodao vi≈°e elemenata?
  // Brzi sanity check:
  // console.log('childElementCount:', container.childElementCount);

  // Osnovni no-overlap (primer: guraj sledeƒáe ulevo/desno po potrebi)
  cards.sort((a, b) => a.offsetTop - b.offsetTop || a.offsetLeft - b.offsetLeft);

  for (let i = 1; i < cards.length; i++) {
    const prev = cards[i - 1].getBoundingClientRect();
    const curEl = cards[i];
    const cur = curEl.getBoundingClientRect();

    const sameRow = Math.abs(cur.top - prev.top) < 1; // ili prag po tvojoj mre≈æi
    if (sameRow && cur.left < prev.right) {
      // pomeri trenutni odmah pored prethodnog
      const shift = (prev.right - cur.left) + 1;
      const currentLeft = parseFloat(getComputedStyle(curEl).left || '0');
      curEl.style.left = (currentLeft + shift) + 'px';
    }
  }
}




		  

  // Keep them updated every minute on the minute
  function scheduleTick() {
    const msToNextMinute = (60 - new Date().getSeconds()) * 1000 + 50;
    setTimeout(() => {
      scrollWrappersToNow();
      setInterval(scrollWrappersToNow, 300*1000);
    }, msToNextMinute);
  }
  //scheduleTick();

	</script>
		<div id="pause" style="position:fixed;bottom:5px;left:5px;font-size:46px;cursor:pointer;z-index:2000000" onclick="pause(this)" data-state="1">‚è∏Ô∏è</div>
		<div id="vremena-dugme" style="position:fixed;bottom:5px;left:55px;font-size:46px;cursor:pointer;z-index:2000000" onclick="showTable()">üïì</div>
		<div id="raspored-dugme" style="position:fixed;bottom:5px;left:105px;font-size:46px;cursor:pointer;z-index:2000000" onclick="showNalozi()">üìã</div>
		<div id="total" style="position:fixed;bottom:5px;left:155px;font-size:46px;cursor:pointer;z-index:2000000" onclick="total()">üìä</div>
		<script>
			function showNalozi(){
				document.getElementById("raspored").style.display = "none"
				document.getElementById("otvoreni-nalozi").style.display = "block"
				document.getElementById("ukupno-nalozi").style.display = "none"
			}

			function total(){
				document.getElementById("raspored").style.display = "none"
				document.getElementById("otvoreni-nalozi").style.display = "none"
				document.getElementById("ukupno-nalozi").style.display = "block"
			}

			function showTable(){
				document.getElementById("raspored").style.display = "block"
				document.getElementById("otvoreni-nalozi").style.display = "none"
				document.getElementById("ukupno-nalozi").style.display = "none"
			}

			function pause(elem){
				if(Number(elem.dataset.state)==1){
					//playing, so pause it
					clearTimeout(pocetna)
					clearTimeout(refresh)
					elem.innerHTML = "‚ñ∂Ô∏è";
					elem.dataset.state = 0;
				}else{
					refresh = setTimeout(function(){
						window.location.reload();
					},360000)

					document.getElementById("raspored").style.display = "none"
					document.getElementById("otvoreni-nalozi").style.display = "none"
					document.getElementById("ukupno-nalozi").style.display = "block"

					pocetna = setTimeout(function(){
						document.getElementById("raspored").style.display = "none"
						document.getElementById("otvoreni-nalozi").style.display = "block"
						document.getElementById("ukupno-nalozi").style.display = "none"
					//},120000)
					},120000);

					elem.innerHTML = "‚è∏Ô∏è"
					elem.dataset.state = 1
				}
			}
		</script>
		<div class="rasporedRadovaUzivo" id="raspored">
			<div id="majstori">
				
			</div>
			<script>
				for(var i=0;i<majstori.length;i++){
					

					if(majstori[i].dodele.length>0){
						var wrap = document.createElement("DIV");
						wrap.setAttribute("class","wrapper");
							var ime = document.createElement("DIV");
							ime.setAttribute("class","ime");
							ime.innerHTML = majstori[i].ime;
							if(majstori[i].raspored==10){
								ime.style = "background-color:rgb(0,0,0);color:rgb(255,255,255)"
							}else if(majstori[i].raspored==20){
								ime.style = "background-color:rgb(200,0,0);color:rgb(255,255,255)"
							}else if(majstori[i].raspored==30){
								console.log(majstori[i].ime)
								ime.style = "background-color:#ffa500;color:rgb(0,0,0)"
							}else if(majstori[i].raspored==40){
								ime.style = "background-color:#fff500;color:rgb(0,0,0)"
							}else if(majstori[i].raspored==50){
								ime.style = "background-color:#00cdfe;color:rgb(0,0,0)"
							}else{
								ime.style = "background-color:#cc8899;color:rgb(255,255,255)"
							}
							wrap.appendChild(ime)

							var timesElem = document.createElement("DIV");
							timesElem.setAttribute("class","times");
							for(var j=0;j<times.length;j++){
								var timestamp = document.createElement("DIV");
								timestamp.setAttribute("class","timestamp");
								timestamp.innerHTML = times[j];
								timesElem.appendChild(timestamp);
							}
							wrap.appendChild(timesElem);

							var rtimesElem = document.createElement("DIV");
							rtimesElem.setAttribute("class","times relativeTimes");
							for(var j=0;j<times.length;j++){
								var timestamp = document.createElement("DIV");
								timestamp.setAttribute("class","timestamp");
								timestamp.innerHTML = times[j];
								rtimesElem.appendChild(timestamp);
							}
							wrap.appendChild(rtimesElem);

							var dodele = document.createElement("DIV");
							dodele.setAttribute("class","dodele");
							wrap.appendChild(dodele);

							var laser = document.createElement("DIV");
							laser.setAttribute("class","laser");
							wrap.appendChild(laser)
						document.getElementById("majstori").appendChild(wrap);
						dodele.style.height = rtimesElem.getBoundingClientRect().height+"px";

						for(var j=0;j<majstori[i].dodele.length;j++){
							var dodelaJson = majstori[i].dodele[j];
							var dodelaWrap = document.createElement("DIV");
							dodelaWrap.setAttribute("class","dodelaWrap");
							dodelaWrap.style.top = getTopForTime(dodelaJson.vremeDolaska)+"px"
							dodelaWrap.style.height = getHeightForDuration(dodelaJson.vremeRadova)+"px"
								var brojNaloga = document.createElement("DIV");
								brojNaloga.setAttribute("class","brojNaloga");
								brojNaloga.innerHTML = "<a href=\"/nalog/"+dodelaJson.nalog+"\" target=\"_blank\">"+dodelaJson.nalog+"</a>";
								dodelaWrap.appendChild(brojNaloga);

								var statusNaloga = document.createElement("DIV");
								statusNaloga.setAttribute("class","statusNaloga");
								statusNaloga.innerHTML = dodelaJson.nalogInfo.statusNaloga;
								dodelaWrap.appendChild(statusNaloga);

								/*var adresaNaloga = document.createElement("DIV");
								adresaNaloga.setAttribute("class","adresaNaloga");
								adresaNaloga.innerHTML = dodelaJson.nalogInfo.radnaJedinica+"<br>"+dodelaJson.nalogInfo.adresa;
								dodelaWrap.appendChild(adresaNaloga);*/
							dodele.appendChild(dodelaWrap);
						}
						adjustLeftPositionsTight(dodele)

						//requestAnimationFrame(() => {
						  //layoutNoOverlap(dodele); // or dodeleElem if you rename it
						//});
						const now = new Date();
						const nowMin = now.getHours() * 60 + now.getMinutes();

						
						const startMin = START_H * 60 + START_M;
						const endMin = END_H * 60 + END_M;
						const sample = wrap.querySelector('.times .timestamp');
						const slotH  = sample ? sample.offsetHeight : 0;
						const elapsed = nowMin - startMin;
						const wholeSlots = Math.floor(elapsed / STEP_MIN);
						const minutesIntoSlot = elapsed % STEP_MIN;
						const insideSlotOffset = (minutesIntoSlot / STEP_MIN) * slotH;

						const padTop = parseFloat(getComputedStyle(wrap).paddingTop) || 0;
						const topPx = padTop + wholeSlots * slotH + insideSlotOffset;
						laser.style.top = `${topPx}px`;
					}
				}

				
			</script>
		</div>
		<div class="otvoreniNaloziUzivo" id="otvoreni-nalozi" style="display:none">

		</div>
		<script>
			function generateNalogRow(elem,nalog,tip){
				var tr = document.createElement("TR");
				if(nalog.vrstaRada=="TEKUCE"){
					tr.style.backgroundColor = "#FFCE1B"
				}
					var td = document.createElement("TD");
					td.setAttribute("class","brojNaloga");
					var extraInfo = Number(nalog.zatvorenaVoda == 1) ? "‚ö†Ô∏è‚ö†Ô∏è" : ""
					td.innerHTML = "<div class=\"value\">"+nalog.broj+extraInfo+"</div>";
					tr.appendChild(td);
					if(!tip){
						var td = document.createElement("TD");
						td.setAttribute("class","tipNaloga");
						
							var printOut = "?";
							if(nalog.statusNaloga=="Potrebna WOMA"){
								printOut = "üöö"
							}else if(nalog.statusNaloga=="Zagu≈°enje"){
								printOut = "ü™†"
							}else if(nalog.statusNaloga=="Zamena"){
								printOut = "ZM"
							}else if(nalog.statusNaloga=="Crpljenje"){
								printOut = "ü™£"
							}else if(nalog.statusNaloga=="Dezinfekcija"){
								printOut = "ü¶†"
							}else if(nalog.statusNaloga=="Masinsko kopanje"){
								printOut = "üöú"
							}else if(nalog.statusNaloga=="Rucno kopanje"){
								printOut = "‚õèÔ∏è"
							}else if(nalog.statusNaloga=="Finalizacija" || nalog.statusNaloga=="Zakazana finalizacija"){
								printOut = "üß±"
							}else if(nalog.statusNaloga=="Betona≈æa" || nalog.statusNaloga=="Asfalt" || nalog.statusNaloga=="Bekaton"){
								printOut = "üöß"
							}else if(nalog.statusNaloga=="Preventivno ƒçi≈°ƒáenje"){
								printOut = "üßº"
							}else if(nalog.statusNaloga=="Snimanje kamerom"){
								printOut = "üé•"
							}else if(nalog.statusNaloga=="Kombinovano"){
								printOut = "üöõ"
							}else if(nalog.statusNaloga=="Potreban pristup"){
								printOut = "‚õî"
							}
							td.innerHTML = printOut;
					}
					tr.appendChild(td);

					var td = document.createElement("TD");
					td.setAttribute("class","planiran");
					td.innerHTML = nalog.planiran==0 ? "‚ùå" : nalog.planiran==1 ? "‚úÖ" : nalog.planiran==2 ? "üìÖ" : "‚ùì";
					tr.appendChild(td);

				elem.appendChild(tr);
			}

			function generateNalogRowGotovo(elem,nalog,tip){
				var tr = document.createElement("TR");
				if(nalog.vrstaRada=="TEKUCE"){
					tr.style.backgroundColor = "#FFCE1B"
				}
				tr.style.backgroundColor = "rgba(20,255,20,0.6)"
					var td = document.createElement("TD");
					td.setAttribute("class","brojNaloga");
					td.innerHTML = "<div class=\"value\">"+nalog.broj+"</div>";
					tr.appendChild(td);

					var td = document.createElement("TD");
					td.setAttribute("class","planiran");
					td.innerHTML = "üèÅ";
					tr.appendChild(td);

				elem.appendChild(tr);
			}

			function generateNalogRowPodizvodjac(elem,nalog,tip){
				var tr = document.createElement("TR");
					var td = document.createElement("TD");
					td.setAttribute("class","brojNaloga");
					td.innerHTML = "<div class=\"value\" style='position:relative'>"+nalog.broj+" / "+getMajstorByCode(nalog.majstor).ime+"</div>";
					tr.appendChild(td);

				elem.appendChild(tr);
			}

			var otvoreniNalozi = <%-JSON.stringify(otvoreniNalozi)%>;
			var zavrseniNalozi = <%-JSON.stringify(zavrseniNalozi)%>;
			var radneJedinice = ["NOVI BEOGRAD","ZEMUN","ƒåUKARICA","RAKOVICA","SAVSKI VENAC","ZVEZDARA","VO≈ΩDOVAC","STARI GRAD","VRAƒåAR","PALILULA"];
			
			for(var i=0;i<radneJedinice.length;i++){
				var radnaJedinica = document.createElement("DIV");
				radnaJedinica.setAttribute("class","radnaJedinica");
					var border = document.createElement("DIV");
					border.setAttribute("class","border");
					radnaJedinica.appendChild(border)
					var relative = document.createElement("DIV");
					relative.setAttribute("class","relative");

						var title = document.createElement("DIV");
						title.setAttribute("class","title");
						title.innerHTML = radneJedinice[i];
						relative.appendChild(title);

						var inlines = document.createElement("DIV");
						inlines.setAttribute("class","inlines");
							var inline = document.createElement("DIV");
							inline.setAttribute("class","inline");
								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Novi radni nalozi:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE");
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												if(istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum)) && otvoreniNalozi[j].statusNaloga=="Primljen"){
													generateNalogRow(table,otvoreniNalozi[j]);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Dodeljen majstoru:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(otvoreniNalozi[j].statusNaloga=="Dodeljen majstoru"){
														generateNalogRow(table,otvoreniNalozi[j],otvoreniNalozi[j].statusNaloga);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Popis"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Spremne zamene:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(otvoreniNalozi[j].statusNaloga=="Zamena"){
														generateNalogRow(table,otvoreniNalozi[j],otvoreniNalozi[j].statusNaloga);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Zamena"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Odgu≈°enja:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(otvoreniNalozi[j].statusNaloga=="Zagu≈°enje"){
														generateNalogRow(table,otvoreniNalozi[j],otvoreniNalozi[j].statusNaloga);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Odgusenje"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Vome:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(otvoreniNalozi[j].statusNaloga=="Potrebna WOMA"){
														generateNalogRow(table,otvoreniNalozi[j],otvoreniNalozi[j].statusNaloga);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="WOMA"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Kopanja:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(otvoreniNalozi[j].statusNaloga=="Masinsko kopanje" || otvoreniNalozi[j].statusNaloga=="Rucno kopanje"){
														generateNalogRow(table,otvoreniNalozi[j]);
													}
													
												//}
												
											}
										}
										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Masinsko kopanje" || zavrseniNalozi[j].danasnjiTipRada=="Rucno kopanje"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);
								
							inlines.appendChild(inline);

							var inline = document.createElement("DIV");
							inline.setAttribute("class","inline");

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Crpljenje i Dezinf.:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Crpljenje","Dezinfekcija"].indexOf(otvoreniNalozi[j].statusNaloga)>=0){
														generateNalogRow(table,otvoreniNalozi[j],);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Crpljenje" || zavrseniNalozi[j].danasnjiTipRada=="Dezinfekcija"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Finalizacija:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Zakazana finalizacija","Finalizacija"].indexOf(otvoreniNalozi[j].statusNaloga)>=0){
														generateNalogRow(table,otvoreniNalozi[j],);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Finalizacija"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Betona≈æe:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Betona≈æa","Asfalt","Bekaton"].indexOf(otvoreniNalozi[j].statusNaloga)>=0){
														generateNalogRow(table,otvoreniNalozi[j],);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Betona≈æa" || zavrseniNalozi[j].danasnjiTipRada=="Asfalt" || zavrseniNalozi[j].danasnjiTipRada=="Bekaton"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Potreban pristup:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Potreban pristup"].indexOf(otvoreniNalozi[j].statusNaloga)>=0){
														generateNalogRow(table,otvoreniNalozi[j]);
													}
													
												//}
												
											}
										}


										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Specifiƒçni nalozi:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Preventivno ƒçi≈°ƒáenje","Snimanje kamerom","Kombinovano"].indexOf(otvoreniNalozi[j].statusNaloga)>=0){
														generateNalogRow(table,otvoreniNalozi[j]);
													}
													
												//}
												
											}
										}

										for(var j=0;j<zavrseniNalozi.length;j++){
											if(zavrseniNalozi[j].radnaJedinica==radneJedinice[i]){
												if(zavrseniNalozi[j].danasnjiTipRada=="Preventivno ƒçi≈°ƒáenje" || zavrseniNalozi[j].danasnjiTipRada=="Snimanje kamerom" || zavrseniNalozi[j].danasnjiTipRada=="Kombinovano"){
													generateNalogRowGotovo(table,zavrseniNalozi[j],zavrseniNalozi[j].statusNaloga);
												}
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Nepokriveno:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)<0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												//if(!istiDatum(today,new Date(otvoreniNalozi[j].digitalizacija.stambeno.datum))){
													if(["Dodeljen majstoru","Konstatacija","Zamena","Zagu≈°enje","Masinsko kopanje","Rucno kopanje","Crpljenje","Dezinfekcija","Finalizacija","Zakazana finalizacija","Betona≈æa","Asfalt","Bekaton","Preventivno ƒçi≈°ƒáenje","Snimanje kamerom","Potrebna WOMA","Kombinovano","Potreban pristup"].indexOf(otvoreniNalozi[j].statusNaloga)<0){
														generateNalogRow(table,otvoreniNalozi[j]);
													}
													
												//}
												
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);

								var group = document.createElement("DIV");
								group.setAttribute("class","group");
									var subTitle = document.createElement("DIV");
									subTitle.setAttribute("class","subTitle");
									subTitle.innerHTML = "Podizvodjaci:";
									group.appendChild(subTitle);

									var nalozi = document.createElement("DIV");
									nalozi.setAttribute("class","nalozi");
										var table = document.createElement("TABLE")
										for(var j=0;j<otvoreniNalozi.length;j++){
											if(otvoreniNalozi[j].radnaJedinica==radneJedinice[i] && podizvodjaci.indexOf(otvoreniNalozi[j].majstor)>=0){
												var today = new Date();
												//today.setDate(today.getDate() - 1);
												generateNalogRowPodizvodjac(table,otvoreniNalozi[j]);
													
												
											}
										}
										nalozi.appendChild(table);
									group.appendChild(nalozi);
								inline.appendChild(group);


							inlines.appendChild(inline);
						relative.appendChild(inlines);

						

					radnaJedinica.appendChild(relative)
				document.getElementById("otvoreni-nalozi").appendChild(radnaJedinica);
			}

			
		</script>

		<div class="ukupnoNaloziUzivo" id="ukupno-nalozi" style="display:none">
			<div class="title">–ü–†–ï–ì–õ–ï–î –ù–ê–õ–û–ì–ê</div>
			<div class="bubbles">
				<div class="bubble" id="ukupno-zamena"><div class="title">–ó–∞–º–µ–Ω–µ üß∞</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-odgusenja"><div class="title">–û–¥–≥—É—à–µ—ö–∞ ü™†</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-konstatacija"><div class="title">–î–æ–¥–µ—ô–µ–Ω–∏</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-finalizacija"><div class="title">–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—ò–∞ üß±</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-voma"><div class="title">–í–æ–º–µ üöö</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-kopanja"><div class="title">–ö–æ–ø–∞—ö–µ üöú‚õèÔ∏è</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-crpljenja"><div class="title">–¶—Ä–ø. –∏ –î–µ–∑. ü™£ü¶†</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-betonaza"><div class="title">–ë–µ—Ç–æ–Ω–∞–∂–µ üöß</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-pristup"><div class="title">–ü–æ—Ç—Ä–µ–±–∞–Ω –ø—Ä–∏—Å—Ç—É–ø</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-specificnih"><div class="title">–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ üé•üöõüßº</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-podizvodjaci"><div class="title">–ü–æ–¥–∏–∑–≤–æ—í–∞—á–∏</div><div class="number"></div></div>
				<div class="bubble" id="ukupno-nepokriveno"><div class="title">–ù–µ–ø–æ–∫—Ä–∏–≤–µ–Ω–æ ‚õî</div><div class="number"></div></div>
			</div>
			<!--<div class="title">–î–ê–ù–ê–° –†–ï–®–ï–ù–û</div>-->
			<div class="jucerasnjiUcinakUzivo">
				<div class="title">–à–£–ß–ï–†–ê–®–ä–ò –£–ß–ò–ù–ê–ö</div>
				<div class="majstoriWrap" id="ucinak"></div>
			</div>
		</div>
		<script>
			var zamene = 0;
			var odgusenja = 0;
			var konstatacije = 0;
			var finalizacije = 0;
			var vome = 0;
			var kopanje = 0;
			var crpljenja = 0;
			var betonaze = 0;
			var pristup = 0;
			var specificni = 0;
			var podizvodjaciNalozi = 0;
			var nepokriveno = 0;
			for(var i=0;i<otvoreniNalozi.length;i++){
				if(podizvodjaci.indexOf(otvoreniNalozi[i].majstor)<0){
					if(["Zamena"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						zamene++;
					}else if(["Zagu≈°enje"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						odgusenja++;
					}else if(["Dodeljen majstoru"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						konstatacije++;
					}else if(["Finalizacija"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						finalizacije++;
					}else if(["Potrebna WOMA"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						vome++;
					}else if(["Masinsko kopanje","Rucno kopanje"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						kopanje++;
					}else if(["Crpljenje","Dezinfekcija"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						crpljenja++;
					}else if(["Betona≈æa","Asfalt","Bekaton"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						betonaze++;
					}else if(["Potreban pristup"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						pristup++;
					}else if(["Preventivno ƒçi≈°ƒáenje","Snimanje kamerom","Kombinovano"].indexOf(otvoreniNalozi[i].statusNaloga)>=0){
						specificni++;
					}else{
						nepokriveno++;
					}
				}else{
					podizvodjaciNalozi++;
				}
			}
			document.getElementById("ukupno-zamena").getElementsByClassName("number")[0].innerHTML = zamene;
			document.getElementById("ukupno-odgusenja").getElementsByClassName("number")[0].innerHTML = odgusenja;
			document.getElementById("ukupno-konstatacija").getElementsByClassName("number")[0].innerHTML = konstatacije;
			document.getElementById("ukupno-finalizacija").getElementsByClassName("number")[0].innerHTML = finalizacije;
			document.getElementById("ukupno-voma").getElementsByClassName("number")[0].innerHTML = vome;
			document.getElementById("ukupno-kopanja").getElementsByClassName("number")[0].innerHTML = kopanje;
			document.getElementById("ukupno-crpljenja").getElementsByClassName("number")[0].innerHTML = crpljenja;
			document.getElementById("ukupno-betonaza").getElementsByClassName("number")[0].innerHTML = betonaze;
			document.getElementById("ukupno-pristup").getElementsByClassName("number")[0].innerHTML = pristup;
			document.getElementById("ukupno-specificnih").getElementsByClassName("number")[0].innerHTML = specificni;
			document.getElementById("ukupno-podizvodjaci").getElementsByClassName("number")[0].innerHTML = podizvodjaciNalozi;
			document.getElementById("ukupno-nepokriveno").getElementsByClassName("number")[0].innerHTML = nepokriveno;
		</script>
		
		
		<script>
			var podelaOpstina = <%-JSON.stringify(podelaOpstina)%>;
			var majstoriZaExport = [];

			var majstori2 = [
    {
        "ime": "Goran Stojanoviƒá",
        "region": "SEVER",
        "zpokc":[1,2,0,2,0]
    },
    {
        "ime": "Igor Bakiƒá",
        "region": "SEVER",
        "zpokc":[1,1,0,0,0]
    },
    {
        "ime": "Kumar Mahendra",
        "region": "SEVER",
        "zpokc":[1,1,1,1,0]
    },
    {
        "ime": "≈Ωivoslav Stanƒçiƒá",
        "region": "SEVER",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Dalibor Tripkoviƒá",
        "region": "ZAPAD",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Tomislav Maksimovic",
        "region": "ZAPAD",
        "zpokc":[3,0,1,2,0]
    },
    {
        "ime": "Vojin Civriƒá",
        "region": "ZAPAD",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Zoran Mihajloviƒá",
        "region": "ZAPAD",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Zoran Veselinoviƒá",
        "region": "ZAPAD",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Aleksandar Pavloviƒá",
        "region": "ISTOK",
        "zpokc":[0,0,0,4,0]
    },
    {
        "ime": "Du≈°ko Spasoviƒá",
        "region": "ISTOK",
        "zpokc":[1,0,0,5,0]
    },
    {
        "ime": "Sasa Jovanoski",
        "region": "ISTOK",
        "zpokc":[0,0,0,3,0]
    },
    {
        "ime": "Uros Janjic",
        "region": "ISTOK",
        "zpokc":[0,2,0,4,0]
    },
    {
        "ime": "Zoran Ostojiƒá",
        "region": "ISTOK",
        "zpokc":[0,0,0,0,0]
    },
    {
        "ime": "Aleksandar  Ramanoviƒá",
        "region": "JUG",
        "zpokc":[1,1,0,2,0]
    },
    {
        "ime": "Anƒëelo Vasiƒá",
        "region": "JUG",
        "zpokc":[2,0,0,2,0]
    },
    {
        "ime": "Goran Stoiljkoviƒá",
        "region": "JUG",
        "zpokc":[2,2,0,2,0]
    }
]
			for(var i=0;i<podelaOpstina.length;i++){
				var opstina = document.createElement("DIV")
				opstina.setAttribute("class","opstina");
					var title = document.createElement("DIV");
					title.setAttribute("class","title");
					title.innerHTML = podelaOpstina[i].naziv;
					opstina.appendChild(title);

					var majstoriElem = document.createElement("DIV");
					majstoriElem.setAttribute("class","majstori");
						for(var j=0;j<majstori.length;j++){
							if(majstori[j].region==podelaOpstina[i].naziv){
								majstoriZaExport.push(majstori[j])
								var majstorElem = document.createElement("DIV");
								majstorElem.setAttribute("class","majstorElem");
									var ime = document.createElement("DIV");
									ime.setAttribute("class","ime");
									ime.innerHTML = majstori[j].ime;
									if(majstori[j].checkIns.length>0){
										ime.style.color = "rgb(20,200,20)"
									}
									majstorElem.appendChild(ime);

									var ucinak = document.createElement("DIV");
									ucinak.setAttribute("class","ucinak");
										var boxes = document.createElement("DIV");
										boxes.setAttribute("class","boxes");

											for(var l=0;l<2;l++){
												var box = document.createElement("DIV");
												box.setAttribute("class","box zamena");
												box.innerHTML = "Z";
												boxes.appendChild(box)
											}

											for(var l=0;l<2;l++){
												var box = document.createElement("DIV");
												box.setAttribute("class","box odgusenje");
												box.innerHTML = "O";
												boxes.appendChild(box)
											}

											for(var l=0;l<2;l++){
												var box = document.createElement("DIV");
												box.setAttribute("class","box konstatacija");
												box.innerHTML = "K";
												boxes.appendChild(box)
											}
										ucinak.appendChild(boxes);

										var boxes = document.createElement("DIV");
										boxes.setAttribute("class","boxes odradjeno");
											if(majstori[j].checkIns.length==0){
												var box = document.createElement("DIV");
												box.setAttribute("class","box nerad");
												box.innerHTML = "ODSUTAN";
												boxes.appendChild(box)
											}else{
												//Prodji kroz dodele
												/*
												<option value="Zamena">Zamena</option>
												<option value="Odgusenje">Odgusenje</option>
												<option value="Popis">Popis</option>
												<option value="Popis">Konstatacija</option>
												<option value="WOMA">–í–û–ú–ê</option>
												<option value="Kombinovano">–ö–æ–º–±–∏–Ω–æ–≤–∞–Ω–æ</option>
												<option value="Zagu≈°enje">–ó–∞–≥—É—à–µ—ö–µ</option>
												<option value="Crpljenje">–¶—Ä–ø—ô–µ—ö–µ</option>
												<option value="Dezinfekcija">–î–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—ò–∞</option>
												<option value="Masinsko kopanje">–ú–∞—à–∏–Ω—Å–∫–æ –∫–æ–ø–∞—ö–µ</option>
												<option value="Rucno kopanje">–†—É—á–Ω–æ –∫–æ–ø–∞—ö–µ</option>
												<option value="Finalizacija">–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—ò–∞</option>
												<option value="Betona≈æa">–ë–µ—Ç–æ–Ω–∞–∂–∞</option>
												<option value="Asfalt">–ê—Å—Ñ–∞–ª—Ç</option>
												<option value="Bekaton">–ë–µ–∫–∞—Ç–æ–Ω</option>
												<option value="Kombinovano">–ö–æ–º–±–∏–Ω–æ–≤–∞–Ω–æ</option>
												<option value="Preventivno ƒçi≈°ƒáenje">–ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–æ —á–∏—à—õ–µ—ö–µ</option>
												<option value="Snimanje kamerom">–°–Ω–∏–º–∞—ö–µ –∫–∞–º–µ—Ä–æ–º</option>
												*/
												majstori[j].dodele.sort((a, b) => {
												    const [ah, am] = a.vremeDolaska.split(":").map(Number);
												    const [bh, bm] = b.vremeDolaska.split(":").map(Number);

												    return ah * 60 + am - (bh * 60 + bm);
												});

												for(var k=0;k<majstori[j].dodele.length;k++){
														console.log(majstori[j].dodele[k])
													if(majstori[j].dodele[k].tipRada=="Zamena"){
														var box = document.createElement("DIV");
														box.setAttribute("class","box zamena");
														var printOut = "Z";
														if(majstori[j].dodele[k].majstorZavrsio==1){
															box.style.color = "rgb(20,255,20)"
														}else if(majstori[j].dodele[k].majstorStigao==1){
															box.style.color = "#ffd343"
														}
														box.innerHTML = printOut;
														boxes.appendChild(box)
													}else if(majstori[j].dodele[k].tipRada=="Odgusenje"){
														var box = document.createElement("DIV");
														box.setAttribute("class","box odgusenje");
														var printOut = "O";
														if(majstori[j].dodele[k].majstorZavrsio==1){
															box.style.color = "rgb(20,255,20)"
														}else if(majstori[j].dodele[k].majstorStigao==1){
															box.style.color = "#ffd343"
														}
														box.innerHTML = printOut;
														boxes.appendChild(box)
													}else if(majstori[j].dodele[k].tipRada=="Popis"){
														var box = document.createElement("DIV");
														box.setAttribute("class","box popis");
														var printOut = "P";
														if(majstori[j].dodele[k].majstorZavrsio==1){
															box.style.color = "rgb(20,255,20)"
														}else if(majstori[j].dodele[k].majstorStigao==1){
															box.style.color = "#ffd343";
														}
														box.innerHTML = printOut;
														boxes.appendChild(box)
													}else if(majstori[j].dodele[k].tipRada=="Konstatacija"){
														var box = document.createElement("DIV");
														box.setAttribute("class","box konstatacija");
														var printOut = "K";
														if(majstori[j].dodele[k].majstorZavrsio==1){
															box.style.color = "rgb(20,255,20)"
														}else if(majstori[j].dodele[k].majstorStigao==1){
															box.style.color = "#ffd343"
														}
														box.innerHTML = printOut;
														boxes.appendChild(box)
													}else if(majstori[j].dodele[k].tipRada=="Crpljenje"){
														var box = document.createElement("DIV");
														box.setAttribute("class","box crpljenje");
														var printOut = "C";
														if(majstori[j].dodele[k].majstorZavrsio==1){
															box.style.color = "rgb(20,255,20)"
														}else if(majstori[j].dodele[k].majstorStigao==1){
															box.style.color = "#ffd343"
														}
														box.innerHTML = printOut;
														boxes.appendChild(box)
													}
												}
											}
											
										ucinak.appendChild(boxes);

									majstorElem.appendChild(ucinak);
								majstoriElem.appendChild(majstorElem)
								opstina.appendChild(majstoriElem)
							}
						}
				document.getElementById("ucinak").appendChild(opstina);
			}
			
			var odradjeno = document.getElementsByClassName("odradjeno");
			

		</script>
		<script>
			var refresh = setTimeout(function(){
				window.location.reload();
			},360000)

			document.getElementById("raspored").style.display = "none";
			document.getElementById("otvoreni-nalozi").style.display = "none";
			document.getElementById("ukupno-nalozi").style.display = "block";

			var pocetna = setTimeout(function(){
				document.getElementById("raspored").style.display = "none"
				document.getElementById("otvoreni-nalozi").style.display = "block"
				document.getElementById("ukupno-nalozi").style.display = "none"
			//},120000)
			},120000);
		</script>
<%- include ("partials/footer") -%>