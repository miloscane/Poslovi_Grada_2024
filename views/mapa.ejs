<%- include ("partials/header") -%>
	<div class="pageWidth">
		<div id="map"></div>
		<script>
			var map;
			var myLatLng;
			var marker;

			function initMap() {
				myLatLng = {lat: 44.800003, lng: 20.45006};//51.896468, 4.419172
				map = new google.maps.Map(document.getElementById('map'), {
					center: myLatLng,
					zoom: 13,
					styles: [
						  {
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#f5f5f5"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.icon",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#616161"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.text.stroke",
						    "stylers": [
						      {
						        "color": "#f5f5f5"
						      }
						    ]
						  },
						  {
						    "featureType": "administrative.land_parcel",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#bdbdbd"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#eeeeee"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#757575"
						      }
						    ]
						  },
						  {
						    "featureType": "poi.park",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#e5e5e5"
						      }
						    ]
						  },
						  {
						    "featureType": "poi.park",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  },
						  {
						    "featureType": "road",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#ffffff"
						      }
						    ]
						  },
						  {
						    "featureType": "road.arterial",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#757575"
						      }
						    ]
						  },
						  {
						    "featureType": "road.highway",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#dadada"
						      }
						    ]
						  },
						  {
						    "featureType": "road.highway",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#616161"
						      }
						    ]
						  },
						  {
						    "featureType": "road.local",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  },
						  {
						    "featureType": "transit.line",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#e5e5e5"
						      }
						    ]
						  },
						  {
						    "featureType": "transit.station",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#eeeeee"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#c9c9c9"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  }
						]
				});
				
				
				/*var contentString = '<div style="text-align:center;"><div style="color:rgba(37,78,118,1); font-weight:bold; margin-top:10px; font-size:14px;">Mobatec<br>Headquarters</div></div>';

				var infowindow = new google.maps.InfoWindow({
					content: contentString
				});
				infowindow.open(map,marker);*/
			}
			setInterval(function(){
				socket.emit("lokacijaMajstora",1)
			},10000)
			var markers = [];
			
			socket.on("lokacijaMajstoraOdgovor",function(data){
				if(data instanceof Array){
					console.log(data)
					if(markers.length==0){
						for(var i=0;i<data.length;i++){
							if(!isNaN(parseFloat(data[i].gpsLat)) && !isNaN(parseFloat(data[i].gpsLon))){
								marker = new google.maps.Marker({
							         position: new google.maps.LatLng(data[i].gpsLat, data[i].gpsLon),
							         map: map,
							         icon:{
							         	url: data[i].ignitionStatus ? "https://maps.google.com/mapfiles/ms/icons/green-dot.png" : "https://maps.google.com/mapfiles/ms/icons/red-dot.png"
							         }
							    });
							    var infowindow = new google.maps.InfoWindow({
									content: data[i].licenceplate
								});
								infowindow.open(map,marker);

							    markers.push(marker)
							}
						}
						console.log("Markers initialized")
					}else{
						for(var i=0;i<data.length;i++){
							markers[i].setPosition(new google.maps.LatLng(data[i].gpsLat, data[i].gpsLon))
							var icon = {url: data[i].ignitionStatus ? "https://maps.google.com/mapfiles/ms/icons/green-dot.png" : "https://maps.google.com/mapfiles/ms/icons/red-dot.png"};
							markers[i].setIcon(icon);
						}
						console.log("Markers updated")
					}
					
					
				}else{
					console.log("Ne mogu da procesuiram podatke sa servera");
				}
			})

		</script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAsUyoMs0Ba_6bPbtD5A5_1yOJXjjMYsMQ&amp;callback=initMap" async="" defer=""></script>
	</div>
<%- include ("partials/footer") -%>