<%- include ("partials/header") -%>
	<style>
		.gm-style-iw{
			padding:0px !important;
		}

		.gm-style .gm-style-iw-d{
			padding:0px !important;
			margin-bottom:-10px;
			margin-right:-10px;
		}

		.gm-ui-hover-effect{
			display:none !important; 
		}
	</style>
	<div class="pageWidth">
		<script>
			var nalozi = <%-JSON.stringify(nalozi)%>;
			var stops = <%-JSON.stringify(stops)%>;
			var pauza = 5;//min
			pauza = 5 * 60000
			//console.log(stops);
			for(var i=0;i<stops.length;i++){
				var stopStart = new Date(stops[i].gmtStopStart);
				var stopEnd = new Date(stops[i].gmtStopEnd);
				var stopTime = stopEnd.getTime() - stopStart.getTime();
				if( stopTime > pauza){
					stops[i].tip = "Pauza"
				}else{
					stops[i].tip = "Lokacija"
				}
				stops[i].trajanje = stopTime;
			}
			for(var i=0;i<stops.length;i++){
				//console.log(stops[i].tip)
			}
		</script>
		<div id="map"></div>
		<script>
			var map;
			var myLatLng;
			var marker;
			var markers;
			var originalCenter;

			function initMap() {
				myLatLng = {lat: 44.800003, lng: 20.45006};//51.896468, 4.419172
				map = new google.maps.Map(document.getElementById('map'), {
					center: myLatLng,
					zoom: 13,
					styles: [
						  {
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#f5f5f5"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.icon",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#616161"
						      }
						    ]
						  },
						  {
						    "elementType": "labels.text.stroke",
						    "stylers": [
						      {
						        "color": "#f5f5f5"
						      }
						    ]
						  },
						  {
						    "featureType": "administrative.land_parcel",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#bdbdbd"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#eeeeee"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#757575"
						      }
						    ]
						  },
						  {
						    "featureType": "poi.park",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#e5e5e5"
						      }
						    ]
						  },
						  {
						    "featureType": "poi.park",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  },
						  {
						    "featureType": "road",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#ffffff"
						      }
						    ]
						  },
						  {
						    "featureType": "road.arterial",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#757575"
						      }
						    ]
						  },
						  {
						    "featureType": "road.highway",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#dadada"
						      }
						    ]
						  },
						  {
						    "featureType": "road.highway",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#616161"
						      }
						    ]
						  },
						  {
						    "featureType": "road.local",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  },
						  {
						    "featureType": "transit.line",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#e5e5e5"
						      }
						    ]
						  },
						  {
						    "featureType": "transit.station",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#eeeeee"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "color": "#c9c9c9"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "elementType": "labels.text.fill",
						    "stylers": [
						      {
						        "color": "#9e9e9e"
						      }
						    ]
						  }
						]
				});
				
				
				/*var contentString = '<div style="text-align:center;"><div style="color:rgba(37,78,118,1); font-weight:bold; margin-top:10px; font-size:14px;">Mobatec<br>Headquarters</div></div>';

				var infowindow = new google.maps.InfoWindow({
					content: contentString
				});
				infowindow.open(map,marker);*/
				for(var i=0;i<nalozi.length;i++){
					marker = new google.maps.Marker({
				         position: {lat: nalozi[i].coordinates.lat, lng: nalozi[i].coordinates.lng},
				         map: map,
				         icon:{
				         	url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png"
				         }
				    });
				    var infowindow = new google.maps.InfoWindow({
						content: "<a href=\"/nalog/"+nalozi[i].nalog+"\" style=\"color:rgb(31,52,101)\" target=\"_blank\">" + nalozi[i].nalog + "</a>"
					});
					infowindow.open(map,marker);
				    markers.push(marker)
				}

				for(var i=0;i<stops.length;i++){
					var position = {lat:0,lng:0}
					if(stops[i].endLatitude>0){
						position.lat = stops[i].endLatitude;
						position.lng = stops[i].endLongitude;
					}else{
						position.lat = stops[i].startLatitude;
						position.lng = stops[i].startLongitude;
					}
					if(stops[i].tip == "Pauza"){
						marker = new google.maps.Marker({
					         position: position,
					         map: map,
					         icon:{
					         	url: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"
					         }
					    });
					    var infowindow = new google.maps.InfoWindow({
							content: eval(stops[i].trajanje*1.66667e-5).toFixed(0) + " min"
						});
						infowindow.open(map,marker);
					    markers.push(marker);
					}else if(stops[i].tip == "Lokacija"){
						marker = new google.maps.Marker({
					         position: position,
					         map: map,
					         icon:{
					         	url: "https://poslovi-grada-2024.fra1.digitaloceanspaces.com/images/green-nav2.png"
					         }
					    });
					    var infowindow = new google.maps.InfoWindow({
							content: eval(stops[i].trajanje*1.66667e-5).toFixed(0) + " min"
						});
						//infowindow.open(map,marker);
					    markers.push(marker);
					}else{
						console.log("Greska 249")
					}
					
				}

			}

			markers = [];
			
			
		</script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyAsUyoMs0Ba_6bPbtD5A5_1yOJXjjMYsMQ&amp;callback=initMap" async="" defer=""></script>
	</div>
<%- include ("partials/footer") -%>
